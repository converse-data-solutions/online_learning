<%= form_with(model: Rating.new, url: course_ratings_path(@course), remote: true, class: "rating-form", data: { course_id: @course.id, rateable_type: rateable.class.name, rateable_id: rateable.id }) do |f| %>
  <div class="star-rating">
    <% (1..5).each do |value| %>
      <span class="star" data-value="<%= value %>"><i class="fas fa-star"></i></span>
    <% end %>
  </div>
  <%= f.hidden_field :star, class: "rating-input" %>
  <%= f.hidden_field :rateable_type, value: @course.class.name %>
  <%= f.hidden_field :rateable_id, value: @course.id %>
  <%= f.submit "Submit Rating", class: "btn btn-primary", style: "display:none" %>
<% end %>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const ratingForms = document.querySelectorAll('.rating-form');

    ratingForms.forEach(form => {
      const stars = form.querySelectorAll('.star');
      const ratingInput = form.querySelector('.rating-input');
      const courseId = form.dataset.courseId;

      stars.forEach(star => {
        star.addEventListener('click', () => {
          const value = parseInt(star.getAttribute('data-value'));
          ratingInput.value = value;
          form.submit();
        });
      });
    });
  });
</script>
